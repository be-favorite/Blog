---
title: "DLNMì„ ì´ìš©í•œ ëŒ€ê¸°ì˜¤ì—¼ì› ê±´ê°•ì˜í–¥í‰ê°€"
subtitle: "ì§ˆë³‘ê´€ë¦¬ì²­ ê±´ê°•ë³´í—˜ ì²­êµ¬ìë£Œ ë°ì´í„° êµìœ¡"
author: "ë°©íƒœëª¨"
institute: "ê°€ì²œëŒ€ ê¸¸ë³‘ì› ì¸ê³µì§€ëŠ¥ë¹…ë°ì´í„°ìœµí•©ì„¼í„°"
date: "2022-07-11"
output:
  xaringan::moon_reader:
    css: 
      - default
      - css/statisticsplaybook.css
      - css/statisticsplaybook-fonts.css
    lib_dir: libs
    seal: false
    nature:
      highlightStyle: googlecode
      highlightLines: true
      highlightLanguage: ["r"]
      countIncrementalSlides: false
      ratio: "16:9"
      navigation:
          scroll: false # disable slide transitions by scrolling
    includes:
      in_header: "assets/mathjax-equation-numbers.html"
      after_body: [css/insert-logo.html]
---

```{r setup, include = FALSE}
library(knitr)
library(rmarkdown)
xaringanExtra::use_panelset()
xaringanExtra::use_clipboard()
# set default options
opts_chunk$set(dpi = 300)
```

class: title-slide, left, bottom

# `r rmarkdown::metadata$title`
----
## **`r rmarkdown::metadata$subtitle`**
### `r rmarkdown::metadata$author`
### `r rmarkdown::metadata$date`

---

# .brand-blue[ëª©ì°¨]

.left-column[
]
.right-column[

- .font130[.content-box-blue[ëª¨í˜• ì†Œê°œ]]

<br>

- .font130[.content-box-blue[ì‹¤ë¬´ ì ìš© ì˜ˆì‹œ]]


<br>

- .font130[.content-box-blue[ì‹¤ìŠµ]]

]

---

class: inverse, middle, center

# ëª¨í˜• ì†Œê°œ

---

## .brand-blue[ëª¨í˜• ì†Œê°œ]
 <!-- ê¸¸ì´ n(t = 1, 2, ... ,n)ì¸ ì‹œê³„ì—´ Y_të¥¼ outcomeìœ¼ë¡œ ëª¨í˜•í™”í•˜ëŠ” DLNMì˜ ê¸°ë³¸ì ì¸ ëª¨í˜•ì‹: -->


\begin{align}
g(\mu_t) = \alpha + s({\boldsymbol{A}}_{t}, {\rm{df}}_p, {\rm{lag}}, {\rm{df}}_l ; {\boldsymbol{\beta}}) + {\boldsymbol{\gamma}}{\boldsymbol{M}}_{t}
\end{align}

.pull-left[

- ì‹œê³„ì—´ íšŒê·€ëª¨í˜•

  - .brand-blue[ë¹„ì„ í˜•ì  íš¨ê³¼]ì™€ .brand-blue[ì§€ì—° íš¨ê³¼(delayed effect)] ë°˜ì˜ ê°€ëŠ¥

<!-- ì¼ë°˜ì ìœ¼ë¡œ ì—°êµ¬ ëŒ€ìƒì´ ê°œì¸ì¸ ë‹¤ë¥¸ ì—°êµ¬ ë°©ë²•ê³¼ ë‹¬ë¦¬ ìƒíƒœí•™ì  ì—°êµ¬ì—ì„œëŠ” ì¸êµ¬ì§‘ë‹¨ì´ ëŒ€ìƒ. ì˜ˆë¥¼ ë“¤ë©´, ë™ì¼í•œ ì‹œëŒ€ì— ë‹¤ë¥¸ ì§€ì—­ì˜ ì¸êµ¬ ì§‘ë‹¨ì¸ êµ­ê°€ ê°„ì˜ ì§ˆë³‘ ë°œìƒë¥ ê³¼ ì‚¬ë§ë¥ ì„ ë¹„êµí•˜ëŠ” ì—°êµ¬ ë“±ì´ í•´ë‹¹í•¨ -->

- ìƒíƒœí•™ì  ì—°êµ¬(ecological study)

  - .brand-blue[í™˜ê²½ì  ìš”ì¸(stressor)]ìœ¼ë¡œ Outcome( $Y_t$ ) ëª¨ë¸ë§
  - íŠ¹ì • .brand-blue[ì˜ˆì¸¡ë³€ìˆ˜] $X_t$.brand-blue[(exposure)]ì˜ íš¨ê³¼ëŠ” ê´€ì¸¡ ì‹œì  ë‹¹ì‹œ ë¿ë§Œì´ ì•„ë‹Œ .brand-blue[ì§€ì—° íš¨ê³¼] ë¹ˆë²ˆíˆ ì¡´ì¬
]

.pull-right[
```{r DLNM, echo = FALSE, out.height = 350, fig.cap = "Fig 1. Gasparrini (2011)"}
knitr::include_graphics("./fig/3dplots.png")
``` 
]

---

class: inverse, middle, center

# ì‹¤ë¬´ ì ìš© ì˜ˆì‹œ

---
## .brand-blue[ì‹¤ë¬´ ì ìš© ì˜ˆì‹œ]

\begin{align}
{\rm{log}}(E(Y_{ijt})) = \alpha + {\rm{NS}}({\boldsymbol{A}}_{ijt}, {\rm{df}}_p, {\rm{lag}}, {\rm{df}}_l ; {\boldsymbol{\beta}}_{ij}) + {\boldsymbol{\gamma}}_{ij}{\boldsymbol{M}}_{ijt} + {\boldsymbol{\delta}}_{ij}{\boldsymbol{S}}_{t} 
\end{align}

.pull-left[
 - ìš°ë¦¬ë‚˜ë¼ 6ê°œ ëŒ€ë„ì‹œì— ëŒ€í•´ 6ì¢…ì˜ ëŒ€ê¸°ì˜¤ì—¼ì›ì´ ì •ì‹ ê³¼ ì§ˆí™˜ì— ë¯¸ì¹˜ëŠ” ê±´ê°•ì˜í–¥í‰ê°€ ìˆ˜í–‰
  
  - ëŒ€ê¸°ì˜¤ì—¼ì›(exposure): ${\rm{PM}}_{10}$, ${\rm{PM}}_{2,5}$, ${\rm{NO}}_{2}$, ${\rm{SO}}_{2}$, ${\rm{O}}_{3}$, ${\rm{NO}}_{2}$
  - ê¸°ìƒìš”ì¸(covariates): ê°•ìˆ˜ëŸ‰, ìƒëŒ€ìŠµë„, í’ì†, ê¸°ì˜¨, ì¼êµì°¨
  - ğŸ”— [ë°ì´í„° ì œê³µ](https://github.com/G-ABCwork/Data_Useful)
  
- .brand-blue[Single exposure DLNM] ê³ ë ¤

]

.pull-right[
 - ìµœì í™” ì•Œê³ ë¦¬ì¦˜ ê°œë°œ
  - Maximum lag days( ${\rm{lag}}$ ): $[7, 8, \cdots, 31]$
  - Degrees of freedom in predictor space( ${\rm{df}}_p$ ): $[2, 3, 4, 5]$
  - Degrees of freedom in additional lag dimension ( ${\rm{df}}_l$ ): $[2, 3, 4, 5]$
  
- ë‹¤ë³€ëŸ‰ ë©”íƒ€ë¶„ì„ ìˆ˜í–‰

  - 6ê°œ ëŒ€ë„ì‹œì— ê´€í•œ ë¶„ì„ ê²°ê³¼ í†µí•©
  
  - (Gasparrini, Armstrong, and Kenward 2012)
]

---

class: inverse, middle, center

# ì‹¤ìŠµ

---

.scroll-output[

 .pull-left[

## .brand-blue[íŒ¨í‚¤ì§€ ì„¤ì¹˜ ë° ë¡œë”©]

```{r, eval = FALSE}
install.packages(c("tidyverse", "dlnm", 
                   "splines", "stringr", 
                   "lubridate"))
```

```{r, message = FALSE}
library(tidyverse)
library(dlnm)
library(splines)
library(stringr)
library(lubridate)
ggplot2::theme_set(theme_bw())
```
]

.pull-right[
 
## .brand-blue[ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°]

- {dlnm} íŒ¨í‚¤ì§€ì˜ 1987-2000ë…„ ì‹œì¹´ê³ ì˜ ì¼ë³„ ì‚¬ë§ê±´ìˆ˜, ê¸°ìƒìš”ì¸, ëŒ€ê¸°ì˜¤ì—¼ì›ì— ê´€í•œ ì •ë³´ê°€ ë‹´ê²¨ìˆëŠ” `chicagoNMMAPS` ìë£Œ ì´ìš©

```{r}
chicago <- chicagoNMMAPS |> 
    as_tibble() |> 
    select(date, time, year, pm10, temp, death)
glimpse(chicago)
```

 
]


]

---

.pull-left[

## .brand-blue[ë°ì´í„° ì¶œë ¥]

```{r}
head(chicago)
```


]

.pull-right[

## .brand-blue[EDA]

```{r EDA, warning = FALSE, fig.height=3.5, fig.retina = 2, fig.align = "center"}
chicago |> 
    ggplot(aes(x = date, y = pm10)) + 
    geom_line()
```

]

---

.scroll-output[

## .brand-blue[Cross-basis matrix ë§Œë“¤ê¸°]

```{r}
cb_pm <- crossbasis(chicago$pm10,
                    lag = 14,
                    argvar = list(fun = "ns", df = 3),
                    arglag = list(fun = "ns", df = 3))
summary(cb_pm)
```

]

---

## .brand-blue[ëª¨í˜• ì í•©]

```{r}
num_year <- chicago |> 
    select(year) |> 
    unique() |> 
    nrow()
mod <- glm(death ~ cb_pm + temp + ns(time, 7*num_year), 
           family = quasipoisson(), data = chicago)
```   

## .brand-blue[ì˜ˆì¸¡ ìˆ˜í–‰]
```{r}
pred_pm <- crosspred(cb_pm, mod, 
                     cen = chicago$pm10 |> 
                         median(na.rm = T),
                     at = 10:80, by = 1)
```

---

## .brand-blue[ë¶„ì„ ê²°ê³¼ ì‹œê°í™”]

.pull-left[

### .black[3D plot]

```{r 3d, warning = FALSE, fig.height=5.5, fig.retina = 2, fig.align = "center"}
plot(pred_pm, xlab = "PM10", zlab = "RR",
     theta = 210, phi = 30, lphi = 30, border = "gray40")
```

]

.pull-right[

### .black[Contour plot]
```{r contour, warning = FALSE, fig.height=5.5, fig.retina = 2, fig.align = "center"}
plot(pred_pm, "contour", xlab = "PM10", ylab = "Lag",
     key.title = title("RR"))
```

]

---

## .brand-blue[ë¶„ì„ ê²°ê³¼ ì‹œê°í™”]

### .black[Overall cumulative association plot]

.pull-left[
```{r OCA-code, eval = FALSE,warning = FALSE, fig.height=3,fig.retina = 2, fig.align = "center"}
plot(pred_pm, "overall", col = "tomato", 
     lwd = 2, xlab = "PM10", ylab = "RR")
rug(chicago$pm10, quiet = TRUE)
``` 
]

.pull-right[
```{r OCA-show, echo = FALSE,warning = FALSE, fig.height=6,fig.retina = 2, fig.align = "center"}
plot(pred_pm, "overall", col = "tomato", lwd = 2, xlab = "PM10", ylab = "RR")
rug(chicago$pm10, quiet = TRUE)
```  
]

---

## .brand-blue[ë¶„ì„ ê²°ê³¼ ì‹œê°í™”]

### .black[High PM10 effect]

.pull-left[
```{r high-code, eval = FALSE, warning = FALSE, fig.height=6, fig.retina = 2, fig.align = "center"}
plot(pred_pm, "slices",
     var = chicago$pm10 |> 
         quantile(0.9, na.rm = TRUE) |> 
         round(0),
     col = "tomato", lwd = 2, ylab = "RR", 
     main = "High PM10 effect (vs 90th quantile)")
```
]

.pull-right[
```{r high-show, echo = FALSE, warning = FALSE, fig.height=6, fig.retina = 2, fig.align = "center"}
plot(pred_pm, "slices",
     var = chicago$pm10 |> 
         quantile(0.9, na.rm = TRUE) |> 
         round(0),
     col = "tomato", lwd = 2, ylab = "RR", 
     main = "High PM10 effect (vs 90th quantile)")
```
]

---

## .brand-blue[ë¶„ì„ ê²°ê³¼ ì‹œê°í™”]

### .black[Low PM10 effect]

.pull-left[
```{r low-code, eval = FALSE, warning = FALSE, fig.height=6, fig.retina = 2, fig.align = "center"}
plot(pred_pm, "slices",
     var = chicago$pm10 |> 
         quantile(0.1, na.rm = TRUE) |> 
         round(0),
     col = "tomato", lwd = 2, ylab = "RR", 
     main = "Low PM10 effect (vs 10th quantile)")
```

]

.pull-right[
```{r low-show, echo = FALSE,warning = FALSE, fig.height=6, fig.retina = 2, fig.align = "center"}
plot(pred_pm, "slices",
     var = chicago$pm10 |> 
         quantile(0.1, na.rm = TRUE) |> 
         round(0),
     col = "tomato", lwd = 2, ylab = "RR", 
     main = "Low PM10 effect (vs 10th quantile)")
```


]

---
class: inverse, middle, center

# References

---

## .brand-blue[References]

[1] Gasparrini, Antonio, Benedict Armstrong, and M.G. Kenward. â€œDistributed Lag Non-Linear Models.â€ Statistics in Medicine 29 (September 20, 2010): 2224â€“34. https://doi.org/10.1002/sim.3940.

[2] Gasparrini, Antonio. â€œDistributed Lag Linear and Non-Linear Models in R: The Package Dlnm.â€ Journal of Statistical Software 43 (July 1, 2011): 1â€“20. https://doi.org/10.18637/jss.v043.i08.

---

class: inverse

# Thanks!

.pull-right[.pull-down[

<a href="mailto:favorite@kakao.com">
.white[`r icons::fontawesome("paper-plane")` favorite@kakao.com]
</a>

<a href="https://github.com/be-favorite">
.white[`r icons::fontawesome("github")` @be-favorite]
</a>

<a href="https://twitter.com/TaemoBang">
.white[`r icons::fontawesome("twitter")` @TaemoBang]
</a>

<a href="https://github.com/be-favorite/Presentation_archive">
.white[`r icons::fontawesome("link")` Presentation archive]
</a>

<br><br><br>

]]